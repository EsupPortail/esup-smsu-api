<Server port="${tomcat.shutdown-port}" shutdown="SHUTDOWN">

	<Listener className="org.apache.catalina.core.AprLifecycleListener" />
	<Listener
		className="org.apache.catalina.mbeans.ServerLifecycleListener" />
	<Listener
		className="org.apache.catalina.mbeans.GlobalResourcesLifecycleListener" />
	<Listener
		className="org.apache.catalina.storeconfig.StoreConfigLifecycleListener" />

<!--BEGIN-LAMBDA-PROBE-ONLY-->
	<GlobalNamingResources>
		<Resource name="UserDatabase" auth="Container"
			type="org.apache.catalina.UserDatabase"
			description="User database that can be updated and saved"
			factory="org.apache.catalina.users.MemoryUserDatabaseFactory"
			pathname="conf/lambda-probe-users.xml" />
	</GlobalNamingResources>
<!--END-LAMBDA-PROBE-ONLY-->

	<Service name="Catalina">
		<Connector 
			port="${tomcat.port}" 
			maxHttpHeaderSize="8192"
			maxThreads="150" 
			minSpareThreads="25" 
			maxSpareThreads="75"
			enableLookups="false" 
			redirectPort="8444" 
			acceptCount="100"
			connectionTimeout="20000" 
			disableUploadTimeout="true"
			scheme="https" secure="true"
            clientAuth="true" sslProtocol="TLS"
            keystoreFile="${tomcat.keystore}" 
            keystorePass="${tomcat.keypass}"
            truststoreFile="${tomcat.truststore}" 
            truststorePass="${tomcat.truststorePass}"
            />
<!--BEGIN-AJP-ONLY-->
    	<Connector 
			port="${tomcat.ajp-port}" 
			enableLookups="false" 
			redirectPort="8444" 
			protocol="AJP/1.3" /> 
<!--END-AJP-ONLY-->
		<Engine 
			name="Catalina" 
			defaultHost="${tomcat.host}">
<!--BEGIN-LAMBDA-PROBE-ONLY-->
			<Realm
				className="org.apache.catalina.realm.UserDatabaseRealm"
				resourceName="UserDatabase" />
<!--END-LAMBDA-PROBE-ONLY-->
			<Host 
				name="${tomcat.host}" 
				appBase="webapps"
				unpackWARs="true" 
				autoDeploy="true" 
				xmlValidation="false"
				xmlNamespaceAware="false">
				<Context 
					path="${tomcat.path}" 
					docBase="${deploy.home}"
					crossContext="true" 
					reloadable="false">
<!--BEGIN-JNDI-ONLY-->
					<Resource name="${hibernate.connection.jndi.datasource}" auth="Container"
						type="javax.sql.DataSource" username="${hibernate.connection.jdbc.username}"
						password="${hibernate.connection.jdbc.password}" 
						driverClassName="${hibernate.connection.driver_class}"
						url="${hibernate.connection.jdbc.url}"
						maxActive="100" maxIdle="10" maxWait="10000"
						removeAbandoned="true" removeAbandonedTimeout="60"
						validationQuery="select 1" testOnBorrow="true"
						logAbandoned="true" />
<!--END-JNDI-ONLY-->
					<Manager
						className="org.apache.catalina.session.StandardManager"
						pathname="" />
				</Context>
			</Host>
		</Engine>
	</Service>
</Server>
